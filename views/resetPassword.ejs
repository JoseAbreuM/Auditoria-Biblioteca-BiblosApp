<!doctype html>
<html lang="en" data-bs-theme="auto">

<head>
  <script src="../assets/js/color-modes.js"></script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Hugo 0.122.0">
  <title>BiblosApp</title>

  <link href="css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/sign-in.css" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">
</head>

<body class="bgrounded-2">
  <main class="form-signin w-100 m-auto shadow-lg box bgrounded">
    <form id="formResetPass" action="/resetPassword" method="POST">
      <img class="mx-auto my-4 d-block" src="img/avatar.png" alt="" width="72">
      <h1 class="h3 mb-3 fw-normal text-center c-w">Recuperar Contrase√±a</h1>
      <div class="form-floating my-4">
        <input type="text" class="form-control" id="Correo" name="Correo" placeholder="Correo">
        <label for="Correo">Correo</label>
        <button type="button" id="getSecurityQuestion" class="btn btn-secondary mt-2">Obtener Pregunta</button>
      </div>
      <div class="form-floating my-4">
        <input type="text" class="form-control" id="securityQuestion" name="securityQuestion"
          placeholder="Pregunta de Seguridad" readonly>
        <label for="securityQuestion">Pregunta de Seguridad</label>
      </div>
      <div class="form-floating my-4">
        <input type="text" class="form-control" id="securityAnswer" name="securityAnswer"
          placeholder="Respuesta de Seguridad">
        <label for="securityAnswer">Respuesta de Seguridad</label>
      </div>
      <button class="btn btn-bd-primary w-100 py-2" type="submit">Validar</button>
      <a href="/login" class="btn btn-bd-secondary">Cancelar</a>
    </form>

    <script>
      function showAlert(title, message, icon, showConfirmButton, timer, route) {
        Swal.fire({
          title: title,
          text: message,
          icon: icon,
          showConfirmButton: showConfirmButton,
          timer: timer
        }).then(() => {
          if (route) {
            window.location = route;
          }
        });
      }

      document.getElementById('getSecurityQuestion').addEventListener('click', function () {
        const correo = document.getElementById('Correo').value;
        if (correo) {
          fetch(`/getSecurityQuestion?Correo=${correo}`)
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                document.getElementById('securityQuestion').value = data.securityQuestion;
              } else {
                showAlert('Error', data.message, 'error', true, 10000, null);
              }
            })
            .catch(error => {
              console.error('Error fetching security question:', error);
              showAlert('Error', 'Error al obtener la pregunta de seguridad', 'error', true, 10000, null);
            });
        } else {
          showAlert('Advertencia', 'Por favor ingrese su correo.', 'info', true, 10000, null);
        }
      });
    </script>
  </main>

  <script src="../assets/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/sweetalert2@11.js"></script>
  <% if (alert) { %>
    <script>
      Swal.fire({
        title: '<%= alertTitle %>',
        text: '<%= alertMessage %>',
        icon: '<%= alertIcon %>',
        showConfirmButton: <%= showConfirmButton %>,
        timer: <%= timer %>
      }).then(() => {
          window.location = '/<%= ruta %>';
        });
    </script>
    <% } %>
</body>


</html>